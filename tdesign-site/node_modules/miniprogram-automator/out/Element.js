"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const isStr_1=__importDefault(require("licia/isStr")),sleep_1=__importDefault(require("licia/sleep")),isUndef_1=__importDefault(require("licia/isUndef"));class Element{constructor(e,t,s){this.tagName="",this.connection=e,this.id=t.elementId,this.pageId=t.pageId,this.nodeId=t.nodeId||null,this.videoId=t.videoId||null,this.tagName=t.tagName,this.elementMap=s}async $(e){try{const t=await this.send("Element.getElement",{selector:e});return Element.create(this.connection,Object.assign({},t,{pageId:this.pageId}),this.elementMap)}catch(e){return null}}async $$(e){const{elements:t}=await this.send("Element.getElements",{selector:e});return t.map(e=>Element.create(this.connection,Object.assign({},e,{pageId:this.pageId}),this.elementMap))}async size(){const[e,t]=await this.domProperty(["offsetWidth","offsetHeight"]);return{width:e,height:t}}async offset(){return await this.send("Element.getOffset")}async text(){return await this.domProperty("innerText")}async attribute(e){if(!isStr_1.default(e))throw Error("name must be a string");return await this.getter(e,"getAttributes","attributes")}async value(){return await this.property("value")}async property(e){if(!isStr_1.default(e))throw Error("name must be a string");let t=this.publicProps;if(t||(t=await this._property("__propPublic"),this.publicProps=t),!t[e])throw Error(`${this.tagName}.${e} not exists`);return this._property(e)}async wxml(){return(await this.send("Element.getWXML",{type:"inner"})).wxml}async outerWxml(){return(await this.send("Element.getWXML",{type:"outer"})).wxml}async style(e){if(!isStr_1.default(e))throw Error("name must be a string");return await this.getter(e,"getStyles","styles")}async tap(){await this.send("Element.tap")}async longpress(){await this.touchstart(),await sleep_1.default(350),await this.touchend()}async trigger(e,t){const s={type:e};isUndef_1.default(t)||(s.detail=t),await this.send("Element.triggerEvent",s)}async touchstart(e={}){await this.send("Element.touchstart",e)}async touchmove(e={}){await this.send("Element.touchmove",e)}async touchend(e={}){await this.send("Element.touchend",e)}async domProperty(e){return await this.getter(e,"getDOMProperties","properties")}async _property(e){return await this.getter(e,"getProperties","properties")}async getter(e,t,s){let n;n=isStr_1.default(e)?[e=e]:e=e;const a=(await this.send(`Element.${t}`,{names:n}))[s];return isStr_1.default(e)?a[0]:a}async send(e,t={}){return t.elementId=this.id,t.pageId=this.pageId,this.nodeId&&(t.nodeId=this.nodeId),this.videoId&&(t.videoId=this.videoId),await this.connection.send(e,t)}async callFunction(e,...t){const{result:s}=await this.send("Element.callFunction",{functionName:e,args:t});return s}static create(e,t,s){if(s.get(t.elementId))return s.get(t.elementId);let n,a=Element;if(t.nodeId)a=CustomElement;else switch(t.tagName){case"input":a=InputElement;break;case"textarea":a=TextareaElement;break;case"scroll-view":a=ScrollViewElement;break;case"swiper":a=SwiperElement;break;case"movable-view":a=MovableViewElement;break;case"switch":a=SwitchElement;break;case"slider":a=SliderElement;break;case"video":a=ContextElement;break;default:a=Element}return n=new a(e,t,s),s.set(t.elementId,n),n}}exports.default=Element;class CustomElement extends Element{async setData(e){await this.send("Element.setData",{data:e})}async data(e){const t={};return e&&(t.path=e),(await this.send("Element.getData",t)).data}async callMethod(e,...t){return(await this.send("Element.callMethod",{method:e,args:t})).result}}exports.CustomElement=CustomElement;class InputElement extends Element{async input(e){await this.callFunction("input.input",e)}}exports.InputElement=InputElement;class TextareaElement extends Element{async input(e){await this.callFunction("textarea.input",e)}}exports.TextareaElement=TextareaElement;class ScrollViewElement extends Element{async scrollTo(e,t){await this.callFunction("scroll-view.scrollTo",e,t)}async property(e){return"scrollTop"===e?await this.callFunction("scroll-view.scrollTop"):"scrollLeft"===e?await this.callFunction("scroll-view.scrollLeft"):super.property(e)}async scrollWidth(){return await this.callFunction("scroll-view.scrollWidth")}async scrollHeight(){return await this.callFunction("scroll-view.scrollHeight")}}exports.ScrollViewElement=ScrollViewElement;class SwiperElement extends Element{async swipeTo(e){await this.callFunction("swiper.swipeTo",e)}}exports.SwiperElement=SwiperElement;class MovableViewElement extends Element{async moveTo(e,t){await this.callFunction("movable-view.moveTo",e,t)}async property(e){return"x"===e?this._property("_translateX"):"y"===e?this._property("_translateY"):super.property(e)}}exports.MovableViewElement=MovableViewElement;class SwitchElement extends Element{async tap(){await this.callFunction("switch.tap")}}exports.SwitchElement=SwitchElement;class SliderElement extends Element{async slideTo(e){await this.callFunction("slider.slideTo",e)}}exports.SliderElement=SliderElement;class ContextElement extends Element{async callContextMethod(e,...t){return(await this.send("Element.callContextMethod",{method:e,args:t})).result}}exports.ContextElement=ContextElement;